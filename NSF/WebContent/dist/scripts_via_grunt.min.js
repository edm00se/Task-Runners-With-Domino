/*
 app-of-ice-and-fire 2015-12-03 
*/
function detectMob(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}function detectPhone(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}function isInArray(a,b){return b.indexOf(a)>-1}!function(){angular.module("westerosiApp",["ui.router","ngTagsInput","ngMessages"]).config(function(a,b){b.otherwise("/about"),a.state("about",{url:"/about",templateUrl:"partials/about.html"}).state("houses",{url:"/houses",templateUrl:"partials/houseList.html",controller:"HouseListCtrl"}).state("newHouse",{url:"/newHouse",templateUrl:"partials/house.html",controller:"NewHouseCtrl"}).state("houses.item",{url:"/:item",templateUrl:"partials/house.html",controller:"OneHouseCtrl"}).state("characters",{url:"/characters",templateUrl:"partials/characterList.html",controller:"CharacterListCtrl"}).state("newCharacter",{url:"/newCharacter",templateUrl:"partials/character.html",controller:"NewCharacterCtrl"}).state("characters.item",{url:"/:item",templateUrl:"partials/character.html",controller:"OneCharacterCtrl"})})}(),function(){angular.module("westerosiApp").controller("CharacterListCtrl",["$scope","$state","$http","$filter","characterCollectionFactory",function(a,b,c,d,e){a.pageQty=5,a.curPage=0,a.numberOfPages=function(){return Math.ceil(a.charactersOfWesteros.length/a.pageQty)||0},a.showSearch=!1,a.charactersOfWesteros=[],e.success(function(b,c,d,e){b.hasOwnProperty("dataAr")?a.charactersOfWesteros=b.dataAr:a.charactersOfWesteros=b}).error(function(b,c,d,e){a.charactersOfWesteros=null,console.log("data: "+b),console.log("status: "+c),console.log("headers: "+d),console.log("config: "+JSON.parse(e))}).then(function(){}),a.removeCharacter=function(a){c({method:"DELETE",url:"characters/"+a}).success(function(b,c,d,e){console.log("successfully deleted character with id: "+a)}).error(function(a,b,c,d){console.log("error, status: "+b+"\nmessage: "+a)}).then(function(){b.go("characters",{},{reload:!0})})}}]).controller("OneCharacterCtrl",["$scope","$state","$stateParams","$http","$filter","characterFactory",function(a,b,c,d,e,f){var g=c.item;console.log("unid: "+g),g.indexOf("-")>-1&&(g=g.replace(/-/g,""));var h=/^[0-9A-Za-z]{32}$/;null!=g&&void 0!=g&&g&&g.trim()&&h.test(g)||b.go("houses"),a.editForm=!1,a.canEditForm=!1,a.myCharacter={};var i=[];f(c.item).success(function(b,c,d,e){if(b.hasOwnProperty("values")){var f={};for(var g in b.values)if(g.indexOf("_FL")>-1);else{var h=g.split("");if(h[0]==h[0].toUpperCase()){h[0]=h[0].toLowerCase();var j=h.join("");f[j]=b.values[g]}else f[g]=b.values[g]}var k={editMode:!0,unid:b.unid,values:f};a.myCharacter=k}else{var f={};for(var g in b)f[g]=b[g];var k={editMode:!0,unid:b.unid,values:f};a.myCharacter=k}a.canEditForm=!0,angular.forEach(a.myCharacter.values,function(a,b){"unid"!=b&&i.push(b)})}).error(function(a,b,c,d){console.log("status: "+b),console.log("data: "+a),console.log("headers: "+c),console.log("config: "+JSON.parse(d))}),a.loadAbilityTags=function(a){return d.get("/tags/abilities.json")},a.peopleAr=[];for(var j=a.$parent.charactersOfWesteros,k=0;k<j.length;k++){var l=j[k];a.peopleAr.push(l.charFirstName+" "+l.charLastName)}a.loadSiblingTags=function(b){return a.peopleAr},a.loadParentTags=function(b){return a.peopleAr},a.loadChildrenTags=function(b){return a.peopleAr},a.setFormEditable=function(){1==a.canEditForm&&(a.editForm=!0)},a.clearCancelForm=function(){b.go("characters")},a.saveCharacterForm=function(){var c=["abilities","siblings","parents","children"],e={unid:a.myCharacter.unid};angular.forEach(i,function(b){var d="unid"!=b,f=!!a.characterForm[b].$dirty&&1==a.characterForm[b].$dirty;if(d&&f){var g=isInArray(b,c);if(g){for(var h=[],i=0;i<a.myCharacter.values[fld].length;i++){var j=a.myCharacter.values[fld][i];h.push(j.text)}e[b]=h}else e[b]=a.myCharacter.values[b]}}),d({method:"PUT",url:"characters/"+a.myCharacter.unid,data:JSON.stringify(e)}).success(function(b,c,d,e){console.log("successfully updated character with unid: "+a.myCharacter.unid)}).error(function(a,b,c,d){console.log("poop")}).then(function(){b.go("characters",{},{reload:!0})})},a.$on("$locationChangeStart",function(b){a.form.$dirty&&!confirm("Abandon unsaved changes?")&&b.preventDefault()})}]).controller("NewCharacterCtrl",["$scope","$state","$stateParams","$http","$filter","characterFactory","characterCollectionFactory",function(a,b,c,d,e,f,g){a.editForm=!0,a.canEditForm=!0,a.myCharacter={};var h=[];a.loadAbilityTags=function(a){return d.get("/tags/abilities.json")},a.peopleAr=[];var i=[];g.success(function(b,c,d,e){i=b.hasOwnProperty("dataAr")?b.dataAr:b;for(var f=0;f<i.length;f++){var g=i[f];a.peopleAr.push(g.charFirstName+" "+g.charLastName)}}).error(function(a,b,c,d){console.log("status: "+b),console.log("data: "+a),console.log("headers: "+c),console.log("config: "+JSON.parse(d))}),a.loadSiblingTags=function(b){return a.peopleAr},a.loadParentTags=function(b){return a.peopleAr},a.loadChildrenTags=function(b){return a.peopleAr},a.setFormEditable=function(){1==a.canEditForm&&(a.editForm=!0)},a.clearCancelForm=function(){b.go("characters")},a.saveCharacterForm=function(){var c=["abilities","siblings","parents","children"];angular.forEach(h,function(b){var d="unid"!=b,e=!!a.characterForm[b].$dirty&&1==a.characterForm[b].$dirty;if(d&&e){var f=isInArray(b,c);if(f){for(var g=[],h=0;h<a.myCharacter.values[fld].length;h++){var i=a.myCharacter.values[fld][h];g.push(i.text)}tmpOb[b]=g}else tmpOb[b]=a.myCharacter.values[b]}}),d({method:"POST",url:"characters",data:JSON.stringify(tmpOb)}).success(function(a,b,c,d){console.log("successfully updated character with unid: "+a.unid)}).error(function(a,b,c,d){console.log("poop")}).then(function(){b.go("characters",{},{reload:!0})})},a.$on("$locationChangeStart",function(b){void 0!=a.form&&a.form.$dirty&&!confirm("Abandon unsaved changes?")&&b.preventDefault()})}])}(),function(){angular.module("westerosiApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}])}(),function(){angular.module("westerosiApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive("tooltip",function(){return{restrict:"A",link:function(a,b,c){angular.element(b).hover(function(){angular.element(b).tooltip("show")},function(){angular.element(b).tooltip("hide")})}}}).directive("ngReallyClick",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){if(a.editForm&&a.editForm){var b=c.ngReallyMessage;b&&confirm(b)&&a.$apply(c.ngReallyClick)}else a.$apply(c.ngReallyClick)})}}}])}(),function(){angular.module("westerosiApp").filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("orderObjectBy",function(){return function(a,b){if(!angular.isObject(a))return a;var c=[];for(var d in a)c.push(a[d]);return c.sort(function(a,c){return a=parseInt(a[b]),c=parseInt(c[b]),a-c}),c}})}();var qString=function(){for(var a={},b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("undefined"==typeof a[e[0]])a[e[0]]=e[1];else if("string"==typeof a[e[0]]){var f=[a[e[0]],e[1]];a[e[0]]=f}else a[e[0]].push(e[1])}return a}();!function(){angular.module("westerosiApp").controller("HouseListCtrl",["$scope","$state","$http","$filter","houseCollectionFactory",function(a,b,c,d,e){a.pageQty=5,a.curPage=0,a.numberOfPages=function(){return Math.ceil(a.housesOfWesteros.length/a.pageQty)||0},a.showSearch=!1,a.housesOfWesteros=[],e.success(function(b,c,d,e){b.hasOwnProperty("dataAr")?a.housesOfWesteros=b.dataAr:a.housesOfWesteros=b}).error(function(b,c,d,e){a.housesOfWesteros=null,console.log("data: "+b),console.log("status: "+c),console.log("headers: "+d),console.log("config: "+JSON.parse(e))}).then(function(){}),a.removeHouse=function(a){c({method:"DELETE",url:"houses/"+a}).success(function(b,c,d,e){console.log("successfully deleted house with id: "+a)}).error(function(a,b,c,d){console.log("error, status: "+b+"\nmessage: "+a)}).then(function(){b.go("houses",{},{reload:!0})})}}]).controller("OneHouseCtrl",["$scope","$state","$stateParams","$http","houseFactory",function(a,b,c,d,e){var f=c.item;console.log("unid: "+f),f.indexOf("-")>-1&&(f=f.replace(/-/g,""));var g=/^[0-9A-Za-z]{32}$/;null!=f&&void 0!=f&&f&&f.trim()&&g.test(f)||b.go("houses"),a.editForm=!1,a.canEditForm=!1,a.myHouse={};var h=[];e(c.item).success(function(b,c,d,e){if(b.hasOwnProperty("values"))a.myHouse=b;else{var f={};for(var g in b)f[g]=b[g];var i={editMode:!0,unid:b.unid,values:f};a.myHouse=i}a.canEditForm=!0,angular.forEach(a.myHouse,function(a,b){"unid"!=b&&h.push(b)})}).error(function(a,b,c,d){console.log("status: "+b),console.log("data: "+a),console.log("headers: "+c),console.log("config: "+JSON.parse(d))}),a.setFormEditable=function(){1==a.canEditForm&&(a.editForm=!0)},a.clearCancelForm=function(){b.go("houses")},a.saveHouseForm=function(){if(houseForm.$valid){var c={unid:a.myHouse.unid};angular.forEach(h,function(b){if(a.houseForm[b].$dirty===!0){var d=a.myHouse[b];c[b]=d}}),d({method:"PUT",url:"houses/"+a.myHouse.unid,data:JSON.stringify(c)}).success(function(b,c,d,e){console.log("successfully updated house with unid: "+a.myHouse.unid)}).error(function(a,b,c,d){console.log("poop")}).then(function(){b.go("houses",{},{reload:!0})})}else{var e=[];angular.forEach(a.houseForm,function(a,b){b.indexOf("$")<0&&(e.push(b),angular.element(houseForm[b]).blur())}),alert("The form shows that there are fields which need to be fixed before you can save.\n\nPlease review the form, correct any validation requirements, and try again.")}},a.$on("$locationChangeStart",function(b){void 0!=a.form&&a.form.$dirty&&!confirm("Abandon unsaved changes?")&&b.preventDefault()})}]).controller("NewHouseCtrl",["$scope","$state","$stateParams","$http",function(a,b,c,d){a.editForm=!0,a.canEditForm=!0,a.myHouse={};a.myHouse={},a.setFormEditable=function(){1==a.canEditForm&&(a.editForm=!0)},a.clearCancelForm=function(){b.go("houses")},a.saveHouseForm=function(){if(houseForm.$valid){var c=null;d({method:"POST",url:"houses",data:JSON.stringify(a.myHouse.values)}).success(function(a,b,d,e){var f=d("Location");null==f?(c=a.unid,console.log("successfully saved new house with unid: "+c)):(c=f.split("/")[3],console.log("successfully saved new house with unid: "+c))}).error(function(a,b,c,d){console.log("error: "+a)}).then(function(){null!=c?b.go("houses.item",{item:c},{reload:!0}):b.go("houses",{},{reload:!0})})}else{var e=[];angular.forEach(a.houseForm,function(a,b){b.indexOf("$")<0&&(e.push(b),angular.element(houseForm[b]).blur())}),alert("The form shows that there are fields which need to be fixed before you can save.\n\nPlease review the form, correct any validation requirements, and try again.")}},a.$on("$locationChangeStart",function(b){void 0!=a.form&&a.form.$dirty&&!confirm("Abandon unsaved changes?")&&b.preventDefault()})}])}(),function(){angular.module("westerosiApp").factory("houseCollectionFactory",["$http",function(a){return a({method:"GET",url:"xsp/houses"})}]).factory("houseFactory",["$http",function(a){return function(b){return a({method:"GET",url:"xsp/houses/"+b})}}]).factory("characterCollectionFactory",["$http",function(a){return a({method:"GET",url:"xsp/characters/"})}]).factory("characterFactory",["$http",function(a){return function(b){return a({method:"GET",url:"xsp/characters/"+b})}}])}();